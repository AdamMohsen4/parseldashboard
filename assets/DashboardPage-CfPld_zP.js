const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/shipmentService-xN7Nw9y-.js","assets/index-pnOeKPMw.js","assets/ui-D-7D7zMz.js","assets/vendor-BhPmHrfx.js","assets/index-Zhr1NJ4U.css"])))=>i.map(i=>d[i]);
import{j as e}from"./ui-D-7D7zMz.js";import{r as s,L as t}from"./vendor-BhPmHrfx.js";import{c as i,B as a,v as r,P as n,s as l,_ as c,C as d,m,t as o,a as h,A as x,w as p,N as u,x as j,T as g,n as v,o as f,p as N,r as y}from"./index-pnOeKPMw.js";import{D as b,a as w,f as k}from"./labelService-DKSFdyXb.js";import{L as S,R as _}from"./refresh-cw-Bc0sZksC.js";import{C}from"./chart-no-axes-column-increasing-vQlRfqAM.js";import{C as A}from"./circle-alert-DfOKyw_L.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=i("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]),L=i("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),U=i("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),T=({status:s})=>e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${(e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"picked_up":return"bg-blue-100 text-blue-800";case"in_transit":return"bg-indigo-100 text-indigo-800";case"delivered":return"bg-green-100 text-green-800";case"exception":case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(s)}`,children:(e=>{switch(e){case"pending":return"Pending";case"picked_up":return"Picked Up";case"in_transit":return"In Transit";case"delivered":return"Delivered";case"exception":return"Exception";case"cancelled":return"Cancelled";default:return"Unknown"}})(s)}),P=({shipment:t})=>{const[i,n]=s.useState(!1);return e.jsxs(a,{size:"sm",variant:"outline",onClick:async()=>{const e=t.trackingCode,s=t.id||"SHIP-"+Math.floor(1e6*Math.random());if(e){n(!0);try{const i=`${t.dimensions.length||"30"}x${t.dimensions.width||"20"}x${t.dimensions.height||"10"} cm`,a=t.pickup||"Unknown pickup location",n=t.delivery||"Unknown delivery location",l=await w({shipmentId:s,carrierName:t.carrier.name,trackingCode:e,senderAddress:a,recipientAddress:n,packageDetails:{weight:String(t.weight)||"1",dimensions:i},language:"en"});l.success?(window.open(l.labelUrl,"_blank"),r({title:"Label Generated",description:"Your shipping label has been generated successfully"})):r({title:"Label Generation Failed",description:l.message||"Unable to generate shipping label",variant:"destructive"})}catch(i){r({title:"Label Generation Error",description:"An unexpected error occurred",variant:"destructive"})}finally{n(!1)}}else r({title:"Error",description:"Unable to generate label: missing tracking code",variant:"destructive"})},disabled:i,children:[i?e.jsx(S,{className:"h-4 w-4 animate-spin"}):e.jsx(b,{className:"h-4 w-4 mr-1"}),"Label"]})},I=({shipment:s})=>e.jsx("div",{className:"py-4 first:pt-0 last:pb-0",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium",children:s.trackingCode}),e.jsx(T,{status:s.status})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Tracking: ",s.trackingCode]}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsxs("span",{children:["Created: ",new Date(s.createdAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{shipment:s}),e.jsx(a,{size:"sm",variant:"outline",asChild:!0,children:e.jsx(t,{to:`/tracking?code=${s.trackingCode}`,children:"Track"})})]})]})}),M=()=>e.jsxs("div",{className:"text-center py-8",children:[e.jsx(n,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3"}),e.jsx("h3",{className:"font-medium text-lg mb-2",children:"No shipments yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Book your first shipment to get started"}),e.jsx(a,{asChild:!0,children:e.jsx(t,{to:"/shipment",children:"Book a Shipment"})})]}),E=({limit:i,showViewAll:n=!1})=>{const[p,u]=s.useState([]),[j,g]=s.useState(!0),{user:v,isSignedIn:f}=l();s.useEffect((()=>{f&&v&&N()}),[f,v,i]);const N=async()=>{if(v){g(!0);try{const e=await k(v.id,i);if(e&&e.length>0){const s=e.map((e=>({id:e.id.toString(),userId:e.user_id,trackingCode:e.tracking_code||"",weight:e.weight||"",dimensions:{length:e.dimension_length||"",width:e.dimension_width||"",height:e.dimension_height||""},pickup:e.pickup_address||"",delivery:e.delivery_address||"",deliverySpeed:e.delivery_speed||"standard",includeCompliance:e.include_compliance||!1,status:e.status||"pending",createdAt:e.created_at,labelUrl:e.label_url,pickupTime:e.pickup_time,totalPrice:Number(e.total_price)||10,estimatedDelivery:e.estimated_delivery?new Date(e.estimated_delivery).toISOString().split("T")[0]:void 0,events:[]})));u(s)}else{const e=await y(v.id,i);u(e)}}catch(e){r({title:"Loading Error",description:"Could not load your shipments. Please try again.",variant:"destructive"})}finally{g(!1)}}},y=async(e,s)=>{try{const t=await c((()=>import("./shipmentService-xN7Nw9y-.js")),__vite__mapDeps([0,1,2,3,4])).then((s=>s.getShipments(e)));return s?t.slice(0,s):t}catch(t){return[]}};return e.jsxs(d,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(o,{className:"text-xl",children:"My Shipments"}),e.jsxs(a,{size:"sm",variant:"outline",onClick:()=>{N()},disabled:j,children:[j?e.jsx(S,{className:"h-4 w-4 animate-spin"}):e.jsx(_,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-2",children:"Refresh"})]})]}),e.jsx(h,{children:j?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(S,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):0===p.length?e.jsx(M,{}):e.jsxs("div",{className:"divide-y",children:[p.map((s=>e.jsx(I,{shipment:s},s.id))),n&&p.length>0&&e.jsx("div",{className:"pt-4",children:e.jsx(a,{variant:"link",className:"p-0 h-auto text-primary",asChild:!0,children:e.jsxs(t,{to:"/shipments",className:"flex items-center",children:["View all shipments ",e.jsx(x,{className:"ml-1 h-3 w-3"})]})})})]})})]})},R=()=>{const{user:i}=l(),[c,b]=s.useState({activeShipments:0,completedShipments:0,totalSpent:0,totalSaved:0}),[w,k]=s.useState([]),[S,_]=s.useState(!0);s.useEffect((()=>{i&&(T(),P())}),[i]);const T=async()=>{if(i){_(!0);try{const{data:e,error:s}=await p.from("booking").select("id").eq("user_id",i.id).in("status",["pending","picked_up","in_transit"]),{data:t,error:a}=await p.from("booking").select("id").eq("user_id",i.id).eq("status","delivered"),{data:r,error:n}=await p.from("booking").select("total_price, carrier_price").eq("user_id",i.id);if(!s&&!a&&!n){const s=(null==r?void 0:r.reduce(((e,s)=>e+(Number(s.total_price)||0)),0))||0,i=(null==r?void 0:r.reduce(((e,s)=>{const t=Number(s.total_price)||0,i=(Number(s.carrier_price)||0)+1.5;return e+Math.max(0,i-t)}),0))||0;b({activeShipments:(null==e?void 0:e.length)||0,completedShipments:(null==t?void 0:t.length)||0,totalSpent:s,totalSaved:i})}}catch(e){}finally{_(!1)}}},P=async()=>{if(i)try{const{data:e,error:s}=await p.from("booking").select("*").eq("user_id",i.id).order("created_at",{ascending:!1}).limit(5);if(s)return;k(e||[])}catch(e){}},I=e=>{switch(null==e?void 0:e.toLowerCase()){case"delivered":return"bg-green-100 text-green-800";case"in_transit":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";case"picked_up":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},M=e=>{if(!e)return"N/A";try{const s=new Date(e);return new Intl.DateTimeFormat("en-US",{month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(s)}catch(s){return e}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(u,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Dashboard"}),e.jsxs("p",{className:"text-muted-foreground",children:["Welcome back, ",(null==i?void 0:i.firstName)||"User"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a,{variant:"outline",onClick:async()=>{_(!0);try{await Promise.all([T(),P()]),r({title:"Dashboard Refreshed",description:"Your dashboard data has been updated."})}catch(e){r({title:"Refresh Failed",description:"Could not refresh dashboard data. Please try again.",variant:"destructive"})}finally{_(!1)}},disabled:S,children:"Refresh Data"}),e.jsx(a,{asChild:!0,children:e.jsxs(t,{to:"/shipment",children:[e.jsx(n,{className:"mr-2 h-4 w-4"}),"New Shipment"]})})]})]}),e.jsxs(d,{className:"bg-primary/5 border-primary/20",children:[e.jsxs(m,{className:"pb-2",children:[e.jsx(o,{children:"Shipping Summary"}),e.jsx(j,{children:"Overview of your shipping activity"})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:e.jsx(n,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Shipments"}),e.jsx("p",{className:"text-xl font-semibold",children:S?"...":c.activeShipments+c.completedShipments})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:e.jsx(U,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completion Rate"}),e.jsx("p",{className:"text-xl font-semibold",children:S?"...":c.activeShipments+c.completedShipments>0?`${Math.round(c.completedShipments/(c.activeShipments+c.completedShipments)*100)}%`:"0%"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:e.jsx(C,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg. Cost Per Shipment"}),e.jsx("p",{className:"text-xl font-semibold",children:S?"...":c.activeShipments+c.completedShipments>0?`€${(c.totalSpent/(c.activeShipments+c.completedShipments)).toFixed(2)}`:"€0.00"})]})]})]}),c.totalSaved>0]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs(d,{children:[e.jsx(m,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium",children:"Active Shipments"})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:S?"...":c.activeShipments}),e.jsxs("div",{className:"mt-1 flex items-center text-sm text-muted-foreground",children:[e.jsx(g,{className:"mr-1 h-4 w-4 text-primary"}),e.jsx("span",{children:"Shipments in progress"})]})]})]}),e.jsxs(d,{children:[e.jsx(m,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium",children:"Completed Shipments"})}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:S?"...":c.completedShipments}),e.jsxs("div",{className:"mt-1 flex items-center text-sm text-muted-foreground",children:[e.jsx(L,{className:"mr-1 h-4 w-4 text-primary"}),e.jsx("span",{children:"Successfully delivered"})]})]})]}),e.jsxs(d,{children:[e.jsx(m,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium",children:"Total Spent"})}),e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-2xl font-bold",children:["€",S?"...":c.totalSpent.toFixed(2)]}),e.jsx(v,{children:e.jsxs(f,{children:[e.jsx(N,{asChild:!0,children:e.jsx(a,{variant:"ghost",size:"icon",className:"h-6 w-6 rounded-full p-0",children:e.jsx(A,{className:"h-4 w-4 text-primary"})})}),e.jsx(y,{className:"max-w-[200px]",children:e.jsxs("p",{children:["You've saved €",c.totalSaved.toFixed(2)," compared to booking directly with carriers."]})})]})})]}),e.jsxs("div",{className:"mt-1 flex items-center text-sm text-muted-foreground",children:[e.jsx(A,{className:"mr-1 h-4 w-4 text-primary"}),e.jsx("span",{children:"Across all shipments"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(d,{className:"lg:col-span-1",children:[e.jsx(m,{children:e.jsx(o,{className:"text-xl",children:"Recent Activity"})}),e.jsx(h,{children:S?e.jsx("div",{className:"text-center py-6",children:"Loading..."}):w.length>0?e.jsxs("div",{className:"space-y-4",children:[w.map((s=>e.jsxs("div",{className:"flex items-start gap-2 pb-4 border-b border-border last:border-0 last:pb-0",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-full",children:e.jsx(D,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:s.carrier_name||"Unknown carrier"}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${I(s.status)}`,children:s.status||"Unknown"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:["ID: ",s.tracking_code||"No tracking code"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:M(s.created_at)})]})]},s.id))),e.jsx("div",{className:"pt-2",children:e.jsx(a,{variant:"link",className:"p-0 h-auto text-primary",asChild:!0,children:e.jsxs(t,{to:"/shipments",className:"flex items-center",children:["View all shipments ",e.jsx(x,{className:"ml-1 h-3 w-3"})]})})})]}):e.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[e.jsx("p",{children:"No recent activities found"}),e.jsx(a,{variant:"link",className:"mt-2",asChild:!0,children:e.jsx(t,{to:"/shipment",children:"Create your first shipment"})})]})})]}),e.jsxs(d,{className:"lg:col-span-2",children:[e.jsx(m,{children:e.jsx(o,{className:"text-xl",children:"Shipment List"})}),e.jsx(h,{children:e.jsx(E,{limit:5,showViewAll:!0})})]})]})]})})]})};
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{R as default};
