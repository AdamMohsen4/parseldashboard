import{c as e,u as s,j as a,d as i,e as r,f as t,B as n,E as l,F as c,m as d,G as o,H as m}from"./ui-BWkg-INl.js";import{r as u,d as h,u as p,L as g}from"./vendor-D4-GdBKu.js";import{c as x,C as v,t as b,s as j,L as f,u as k,N as y,a as N,b as w,B as C,d as S,e as E,U as F,S as P,I,G as D,f as B}from"./index-CKYxIDV8.js";import{u as R}from"./index-Bp323OVb.js";import{S as q}from"./separator-DRkuGrVl.js";import{g as A,s as _,D as U,a as L}from"./bookingDb-60cdlQye.js";import{saveShipment as T}from"./shipmentService-DG7zvYy_.js";import{C as G}from"./checkbox-BQwagL8I.js";import{S as $,a as H,b as O,c as W,d as V}from"./select-c5_qQKtM.js";import"./charts-DzBBKkH1.js";var M="Radio",[z,Y]=e(M),[J,K]=z(M),X=u.forwardRef(((e,t)=>{const{__scopeRadio:n,name:l,checked:c=!1,required:d,disabled:o,value:m="on",onCheck:h,form:p,...g}=e,[x,v]=u.useState(null),b=s(t,(e=>v(e))),j=u.useRef(!1),f=!x||(p||!!x.closest("form"));return a.jsxs(J,{scope:n,checked:c,disabled:o,children:[a.jsx(i.button,{type:"button",role:"radio","aria-checked":c,"data-state":se(c),"data-disabled":o?"":void 0,disabled:o,value:m,...g,ref:b,onClick:r(e.onClick,(e=>{c||null==h||h(),f&&(j.current=e.isPropagationStopped(),j.current||e.stopPropagation())}))}),f&&a.jsx(ee,{control:x,bubbles:!j.current,name:l,value:m,checked:c,required:d,disabled:o,form:p,style:{transform:"translateX(-100%)"}})]})}));X.displayName=M;var Q="RadioIndicator",Z=u.forwardRef(((e,s)=>{const{__scopeRadio:r,forceMount:n,...l}=e,c=K(Q,r);return a.jsx(t,{present:n||c.checked,children:a.jsx(i.span,{"data-state":se(c.checked),"data-disabled":c.disabled?"":void 0,...l,ref:s})})}));Z.displayName=Q;var ee=e=>{const{control:s,checked:i,bubbles:r=!0,...t}=e,l=u.useRef(null),c=R(i),d=n(s);return u.useEffect((()=>{const e=l.current,s=window.HTMLInputElement.prototype,a=Object.getOwnPropertyDescriptor(s,"checked").set;if(c!==i&&a){const s=new Event("click",{bubbles:r});a.call(e,i),e.dispatchEvent(s)}}),[c,i,r]),a.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:i,...t,tabIndex:-1,ref:l,style:{...e.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function se(e){return e?"checked":"unchecked"}var ae=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ie="RadioGroup",[re,te]=e(ie,[l,Y]),ne=l(),le=Y(),[ce,de]=re(ie),oe=u.forwardRef(((e,s)=>{const{__scopeRadioGroup:r,name:t,defaultValue:n,value:l,required:m=!1,disabled:u=!1,orientation:h,dir:p,loop:g=!0,onValueChange:x,...v}=e,b=ne(r),j=c(p),[f,k]=d({prop:l,defaultProp:n,onChange:x});return a.jsx(ce,{scope:r,name:t,required:m,disabled:u,value:f,onValueChange:k,children:a.jsx(o,{asChild:!0,...b,orientation:h,dir:j,loop:g,children:a.jsx(i.div,{role:"radiogroup","aria-required":m,"aria-orientation":h,"data-disabled":u?"":void 0,dir:j,...v,ref:s})})})}));oe.displayName=ie;var me="RadioGroupItem",ue=u.forwardRef(((e,i)=>{const{__scopeRadioGroup:t,disabled:n,...l}=e,c=de(me,t),d=c.disabled||n,o=ne(t),h=le(t),p=u.useRef(null),g=s(i,p),x=c.value===l.value,v=u.useRef(!1);return u.useEffect((()=>{const e=e=>{ae.includes(e.key)&&(v.current=!0)},s=()=>v.current=!1;return document.addEventListener("keydown",e),document.addEventListener("keyup",s),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",s)}}),[]),a.jsx(m,{asChild:!0,...o,focusable:!d,active:x,children:a.jsx(X,{disabled:d,required:c.required,checked:x,...h,...l,name:c.name,ref:g,onCheck:()=>c.onValueChange(l.value),onKeyDown:r((e=>{"Enter"===e.key&&e.preventDefault()})),onFocus:r(l.onFocus,(()=>{var e;v.current&&(null==(e=p.current)||e.click())}))})})}));ue.displayName=me;var he=u.forwardRef(((e,s)=>{const{__scopeRadioGroup:i,...r}=e,t=le(i);return a.jsx(Z,{...t,...r,ref:s})}));he.displayName="RadioGroupIndicator";var pe=oe,ge=ue,xe=he;const ve=u.forwardRef((({className:e,...s},i)=>a.jsx(pe,{className:x("grid gap-2",e),...s,ref:i})));ve.displayName=pe.displayName;const be=u.forwardRef((({className:e,...s},i)=>a.jsx(ge,{ref:i,className:x("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...s,children:a.jsx(xe,{className:"flex items-center justify-center",children:a.jsx(v,{className:"h-2.5 w-2.5 fill-current text-current"})})})));be.displayName=ge.displayName;const je=[{id:"slot-1",date:"2023-11-10",timeWindow:"09:00 - 12:00",available:!0},{id:"slot-2",date:"2023-11-10",timeWindow:"13:00 - 16:00",available:!0},{id:"slot-3",date:"2023-11-11",timeWindow:"09:00 - 12:00",available:!0},{id:"slot-4",date:"2023-11-11",timeWindow:"13:00 - 16:00",available:!0},{id:"slot-5",date:"2023-11-12",timeWindow:"09:00 - 12:00",available:!0}],fe=async e=>{try{const r=(e=>!e.weight||parseFloat(e.weight)<=0?{valid:!1,message:"Invalid package weight"}:e.dimensions&&e.dimensions.length&&e.dimensions.width&&e.dimensions.height?e.pickup?e.delivery?e.carrier&&e.carrier.name?e.userId?e.weight&&parseFloat(e.weight)>100?{valid:!1,message:"Package weight exceeds maximum allowed (100kg)"}:{valid:!0}:{valid:!1,message:"User ID is required"}:{valid:!1,message:"Carrier information is required"}:{valid:!1,message:"Delivery address is required"}:{valid:!1,message:"Pickup address is required"}:{valid:!1,message:"Package dimensions are incomplete"})(e);if(!r.valid)return b({title:"Validation Error",description:r.message||"Please check your shipment details",variant:"destructive"}),{success:!1,message:r.message||"Invalid booking request"};const t=`SHIP-${Math.floor(1e6*Math.random())}`,n=`EP${Math.floor(1e7*Math.random())}FI`,l=new Date;l.setHours(l.getHours()+1);const c=await A({shipmentId:t,carrierName:e.carrier.name,trackingCode:n,senderAddress:e.pickup,recipientAddress:e.delivery,packageDetails:{weight:e.weight,dimensions:`${e.dimensions.length}x${e.dimensions.width}x${e.dimensions.height} cm`}});if(!c.success)return b({title:"Label Generation Failed",description:"Unable to generate shipping label. Please try again.",variant:"destructive"}),{success:!1,message:"Failed to generate shipping label"};const d=await(async e=>{try{await new Promise((e=>setTimeout(e,1e3)));let s="";if(e.slotId){const a=je.find((s=>s.id===e.slotId));a&&(s=`${a.date} ${a.timeWindow.split(" - ")[0]}`)}else{const e=je.find((e=>e.available));e&&(s=`${e.date} ${e.timeWindow.split(" - ")[0]}`)}return s?{confirmed:!0,pickupTime:s}:{confirmed:!1,message:"No available pickup slots"}}catch(s){return b({title:"Pickup Scheduling Failed",description:"Unable to schedule pickup. Please try again.",variant:"destructive"}),{confirmed:!1,message:"Failed to schedule pickup"}}})({shipmentId:t,carrierName:e.carrier.name,pickupAddress:e.pickup,slotId:e.pickupSlotId});if(!d.confirmed)return b({title:"Pickup Scheduling Failed",description:"Unable to schedule pickup. Please try a different time or contact support.",variant:"destructive"}),{success:!1,message:"Failed to schedule pickup"};const o=(s=e.carrier.price,a=e.includeCompliance,s+(a?2:0)),m=(e=>{const s=new Date;switch(e){case"standard":s.setDate(s.getDate()+3);break;case"express":s.setDate(s.getDate()+1);break;default:s.setDate(s.getDate()+5)}return s.toISOString().split("T")[0]})(e.deliverySpeed);if(await _(e,n,c.labelUrl,d.pickupTime,o,m,l))b({title:"Booking Saved",description:"Your shipment has been successfully recorded in our database."});else{b({title:"Database Save Warning",description:"Could not save to primary database, using backup storage instead.",variant:"destructive"});try{if(!(await T({userId:e.userId,trackingCode:n,carrier:e.carrier,weight:e.weight,dimensions:e.dimensions,pickup:e.pickup,delivery:e.delivery,deliverySpeed:e.deliverySpeed,includeCompliance:e.includeCompliance,labelUrl:c.labelUrl,pickupTime:d.pickupTime,totalPrice:o,status:"pending",estimatedDelivery:m})))throw new Error("Failed to save shipment data to local storage")}catch(i){return b({title:"Booking Storage Failed",description:"Unable to save your booking. Please take a screenshot of your booking details.",variant:"destructive"}),{success:!0,shipmentId:t,trackingCode:n,labelUrl:c.labelUrl,pickupTime:d.pickupTime,totalPrice:o,message:"Booking completed but not saved. Please save your tracking information."}}}return{success:!0,shipmentId:t,trackingCode:n,labelUrl:c.labelUrl,pickupTime:d.pickupTime,totalPrice:o,cancellationDeadline:l.toISOString(),canBeCancelled:!0}}catch(r){let e="An unexpected error occurred";return r instanceof Error&&(r.message.includes("label")?e="Error generating shipping label":r.message.includes("pickup")?e="Error scheduling pickup":r.message.includes("save")&&(e="Error saving shipment data")),b({title:"Booking Failed",description:"There was a problem processing your booking. Please try again.",variant:"destructive"}),{success:!1,message:e}}var s,a},ke=({value:e,onChange:s})=>a.jsxs("div",{className:"space-y-2",children:[a.jsx(f,{htmlFor:"label-language",className:"text-sm font-medium",children:"Label Language"}),a.jsxs($,{value:e,onValueChange:s,children:[a.jsx(H,{id:"label-language",className:"w-full bg-background border-input",children:a.jsx(O,{placeholder:"Select language"})}),a.jsxs(W,{children:[a.jsx(V,{value:"en",children:"English"}),a.jsx(V,{value:"fi",children:"Finnish"}),a.jsx(V,{value:"sv",children:"Swedish"}),a.jsx(V,{value:"no",children:"Norwegian"}),a.jsx(V,{value:"da",children:"Danish"})]})]})]}),ye=({customerType:e})=>{const{isSignedIn:s,user:i}=k(),r=h(),t=p(),[n,l]=u.useState("5"),[c,d]=u.useState("20"),[o,m]=u.useState("15"),[x,v]=u.useState("10"),[R,_]=u.useState("Stockholm, SE"),[T,$]=u.useState("Helsinki, FI"),[H,O]=u.useState("standard"),[W,V]=u.useState(!1);u.useState(!1);const[M,z]=u.useState(!1),[Y,J]=u.useState(null),[K,X]=u.useState(e||null),[Q,Z]=u.useState(""),[ee,se]=u.useState(""),[ae,ie]=u.useState(!1),[re,te]=u.useState(!1),[ne,le]=u.useState("en"),[ce,de]=u.useState(!1);u.useEffect((()=>{(async()=>{if(s&&i){const e=localStorage.getItem("lastBooking");if(e){const{trackingCode:s,timestamp:a}=JSON.parse(e),r=await L(s,i.id);if(r){J(r),ie(!0);const e=new Date(r.cancellation_deadline);new Date<e?te(!0):(localStorage.removeItem("lastBooking"),te(!1))}else localStorage.removeItem("lastBooking")}}})()}),[s,i]);const oe=!K&&"/shipment"===r.pathname;u.useEffect((()=>{e&&X(e)}),[e]);const me={id:1,name:"E-Parcel Nordic",price:(()=>{switch(K){case"business":return 9;case"ecommerce":return 8;default:return 10}})(),eta:"3 days",icon:"ðŸ“¦"},ue=e=>{e&&t(`/shipment/${e}`)};return oe?a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsx(y,{}),a.jsxs("div",{className:"container mx-auto px-4 py-12",children:[a.jsx("h1",{className:"text-3xl font-bold text-center mb-8",children:"Select Customer Type"}),a.jsxs("div",{className:"max-w-3xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsxs(N,{className:"cursor-pointer hover:border-primary transition-colors",onClick:()=>ue("business"),children:[a.jsxs(w,{className:"flex flex-col items-center",children:[a.jsx(C,{className:"h-12 w-12 text-primary mb-2"}),a.jsx(S,{children:"Business"})]}),a.jsxs(E,{className:"text-center",children:[a.jsx("p",{className:"text-muted-foreground mb-4",children:"For registered businesses shipping commercial goods"}),a.jsx("p",{className:"text-sm font-medium text-primary",children:"â‚¬9 base rate"})]})]}),a.jsxs(N,{className:"cursor-pointer hover:border-primary transition-colors",onClick:()=>ue("private"),children:[a.jsxs(w,{className:"flex flex-col items-center",children:[a.jsx(F,{className:"h-12 w-12 text-primary mb-2"}),a.jsx(S,{children:"Private Customer"})]}),a.jsxs(E,{className:"text-center",children:[a.jsx("p",{className:"text-muted-foreground mb-4",children:"For individuals shipping personal items"}),a.jsx("p",{className:"text-sm font-medium text-primary",children:"â‚¬10 base rate"})]})]}),a.jsxs(N,{className:"cursor-pointer hover:border-primary transition-colors",onClick:()=>ue("ecommerce"),children:[a.jsxs(w,{className:"flex flex-col items-center",children:[a.jsx(P,{className:"h-12 w-12 text-primary mb-2"}),a.jsx(S,{children:"E-commerce Business"})]}),a.jsxs(E,{className:"text-center",children:[a.jsx("p",{className:"text-muted-foreground mb-4",children:"For online retailers with regular shipments"}),a.jsx("p",{className:"text-sm font-medium text-primary",children:"â‚¬8 base rate"})]})]})]})]})]}):a.jsxs("div",{className:"min-h-screen bg-background",children:[a.jsx(y,{}),a.jsx("div",{className:"container mx-auto px-4 py-8",children:a.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[a.jsx("div",{className:"md:w-2/5",children:a.jsxs(N,{children:[a.jsxs(w,{className:"flex flex-row items-center justify-between",children:[a.jsx(S,{children:"Book a Shipment"}),K&&a.jsxs("div",{className:"flex items-center gap-2 bg-primary/10 text-primary px-3 py-1 rounded-full",children:["business"===K&&a.jsx(C,{className:"h-4 w-4"}),"private"===K&&a.jsx(F,{className:"h-4 w-4"}),"ecommerce"===K&&a.jsx(P,{className:"h-4 w-4"}),a.jsx("span",{className:"text-sm capitalize",children:K})]})]}),a.jsx(E,{children:ae?a.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-500",children:[a.jsx("h4",{className:"font-medium mb-2 text-green-700",children:"Booking Confirmed!"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Tracking Code:"})," ",(null==Y?void 0:Y.trackingCode)||(null==Y?void 0:Y.tracking_code)]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Carrier:"})," ",(null==Y?void 0:Y.carrier_name)||me.name]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Total Price:"})," â‚¬",(null==Y?void 0:Y.totalPrice)||(null==Y?void 0:Y.total_price)]}),a.jsxs("div",{className:"pt-3 flex gap-2",children:[a.jsx(B,{size:"sm",variant:"outline",asChild:!0,children:a.jsx(g,{to:"/dashboard",children:"View All Shipments"})}),a.jsx(B,{size:"sm",variant:"default",onClick:()=>{ie(!1),J(null),localStorage.removeItem("lastBooking")},children:"Book Another Shipment"})]})]})]}):a.jsxs("form",{onSubmit:e=>{e.preventDefault(),(async()=>{var e;if(s&&i){z(!0);try{const e=await fe({weight:n,dimensions:{length:c,width:o,height:x},pickup:R,delivery:T,carrier:{name:me.name,price:me.price},deliverySpeed:H,includeCompliance:W,userId:i.id,customerType:K||"private",businessName:"business"===K||"ecommerce"===K?Q:void 0,vatNumber:"business"===K?ee:void 0});e.success?(J(e),ie(!0),te(!0),localStorage.setItem("lastBooking",JSON.stringify({trackingCode:e.trackingCode,timestamp:(new Date).toISOString()})),b({title:"Shipment Booked",description:`Your shipment has been booked with tracking code: ${e.trackingCode}`})):b({title:"Booking Failed",description:e.message||"There was a problem with your booking.",variant:"destructive"})}catch(a){b({title:"Booking Error",description:"An unexpected error occurred.",variant:"destructive"})}finally{z(!1)}}else null==(e=document.querySelector("button.cl-userButtonTrigger"))||e.click()})()},className:"space-y-6",children:[("business"===K||"ecommerce"===K)&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"font-semibold",children:"Business Details"}),a.jsxs("div",{children:[a.jsx(f,{htmlFor:"businessName",children:"Business Name"}),a.jsx(I,{id:"businessName",type:"text",placeholder:"Enter business name",value:Q,onChange:e=>Z(e.target.value),required:!0})]}),"business"===K&&a.jsxs("div",{children:[a.jsx(f,{htmlFor:"vatNumber",children:"VAT Number"}),a.jsx(I,{id:"vatNumber",type:"text",placeholder:"Enter VAT number",value:ee,onChange:e=>se(e.target.value),required:!0})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"font-semibold",children:"Package Details"}),a.jsxs("div",{children:[a.jsx(f,{htmlFor:"weight",children:"Weight (kg)"}),a.jsx(I,{id:"weight",type:"number",placeholder:"Enter weight",min:"0.1",max:"100",step:"0.1",value:n,onChange:e=>l(e.target.value),required:!0})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx(f,{htmlFor:"length",children:"Length (cm)"}),a.jsx(I,{id:"length",type:"number",placeholder:"L",value:c,onChange:e=>d(e.target.value),required:!0})]}),a.jsxs("div",{children:[a.jsx(f,{htmlFor:"width",children:"Width (cm)"}),a.jsx(I,{id:"width",type:"number",placeholder:"W",value:o,onChange:e=>m(e.target.value),required:!0})]}),a.jsxs("div",{children:[a.jsx(f,{htmlFor:"height",children:"Height (cm)"}),a.jsx(I,{id:"height",type:"number",placeholder:"H",value:x,onChange:e=>v(e.target.value),required:!0})]})]})]}),a.jsx(q,{}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"font-semibold",children:"Locations"}),a.jsxs("div",{children:[a.jsx(f,{htmlFor:"pickup",children:"Pickup Address"}),a.jsx(D,{id:"pickup",placeholder:"Enter pickup address",value:R,onChange:e=>_(e.target.value),onPlaceSelect:e=>_(e),required:!0})]}),a.jsxs("div",{children:[a.jsx(f,{htmlFor:"delivery",children:"Delivery Address"}),a.jsx(D,{id:"delivery",placeholder:"Enter delivery address",value:T,onChange:e=>$(e.target.value),onPlaceSelect:e=>$(e),required:!0})]})]}),a.jsx(q,{}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"font-semibold",children:"Delivery Options"}),a.jsx(ve,{value:H,onValueChange:O,className:"space-y-2",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(be,{value:"standard",id:"standard"}),a.jsx(f,{htmlFor:"standard",children:"Standard (3 days)"})]})}),a.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[a.jsx(G,{id:"compliance",checked:W,onCheckedChange:e=>V(!0===e)}),a.jsxs(f,{htmlFor:"compliance",className:"text-sm",children:["Add Compliance Package (+â‚¬2)",a.jsx(g,{to:"/compliance",className:"ml-1 text-primary text-sm underline",children:"Learn more"})]})]})]}),a.jsxs("div",{className:"flex flex-col space-y-2",children:[a.jsx(B,{type:"submit",className:"w-full",disabled:M||ae,children:M?"Processing...":ae?"Booked":"Book Shipment"}),!1]})]})})]})}),a.jsx("div",{className:"md:w-3/5",children:a.jsxs(N,{children:[a.jsx(w,{children:a.jsx(S,{children:"Fixed Rate Shipping"})}),a.jsx(E,{children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"border border-primary rounded-lg p-4 flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"text-2xl",children:me.icon}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium",children:me.name}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:["Estimated delivery: ",me.eta]})]})]}),a.jsx("div",{className:"text-right",children:a.jsxs("p",{className:"text-lg font-bold",children:["â‚¬",me.price,W?" + â‚¬2":""]})})]}),a.jsxs("div",{className:"mt-8 bg-muted p-4 rounded-lg",children:[a.jsx("h4",{className:"font-medium mb-2",children:"About our rates"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"All shipments include tracking and insurance up to â‚¬500. Additional insurance can be purchased during checkout. Rates shown include all taxes and fees."}),K&&a.jsxs("div",{className:"mt-3 pt-3 border-t border-border",children:[a.jsxs("h5",{className:"font-medium text-sm mb-1",children:["business"===K&&"Business Rate","private"===K&&"Private Customer Rate","ecommerce"===K&&"E-commerce Business Rate"]}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:["business"===K&&"Our business rate includes commercial insurance and priority handling.","private"===K&&"Our standard rate for private customers includes all basic services.","ecommerce"===K&&"Our special e-commerce rate includes volume discounts and integration capabilities."]})]})]}),re&&Y&&a.jsxs("div",{className:"mt-8 bg-amber-50 p-4 rounded-lg border border-amber-500",children:[a.jsx("h4",{className:"font-medium mb-2 text-amber-700",children:"Cancel Booking"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("p",{children:["You can cancel this booking until:",a.jsx("br",{}),a.jsx("strong",{children:new Date(Y.cancellationDeadline||Y.cancellation_deadline).toLocaleString()})]}),a.jsx("p",{className:"text-muted-foreground",children:"After this time, cancellation will not be possible and you will be charged for the shipment."}),a.jsx("div",{className:"pt-3",children:a.jsx(B,{size:"sm",variant:"destructive",onClick:async()=>{if(!(null==Y?void 0:Y.trackingCode)&&!(null==Y?void 0:Y.tracking_code))return;const e=Y.trackingCode||Y.tracking_code;if(e&&(null==i?void 0:i.id))try{const s=await(async(e,s)=>{try{const{data:a,error:i}=await j.from("booking").select("*").eq("tracking_code",e).eq("user_id",s).single();if(i||!a)return b({title:"Booking Not Found",description:"Unable to find the specified booking.",variant:"destructive"}),!1;const r=new Date(a.created_at);if(r.setHours(r.getHours()+1),new Date>r)return b({title:"Cancellation Failed",description:"The cancellation window (1 hour) has expired.",variant:"destructive"}),!1;const{error:t}=await j.from("booking").update({status:"cancelled"}).eq("tracking_code",e).eq("user_id",s);return t?(b({title:"Cancellation Failed",description:"Unable to cancel the booking. Please try again.",variant:"destructive"}),!1):(b({title:"Booking Cancelled",description:"Your shipment has been successfully cancelled."}),!0)}catch(a){return b({title:"Cancellation Error",description:"An unexpected error occurred. Please try again.",variant:"destructive"}),!1}})(e,i.id);s?(ie(!1),J(null),te(!1),localStorage.removeItem("lastBooking"),b({title:"Booking Cancelled",description:"Your booking has been successfully cancelled."})):b({title:"Cancellation Failed",description:"Unable to cancel booking. Please try again or contact support.",variant:"destructive"})}catch(s){b({title:"Cancellation Error",description:"An unexpected error occurred.",variant:"destructive"})}},children:"Cancel Booking"})})]})]}),Y&&a.jsxs("div",{className:"mt-8 bg-blue-50 p-4 rounded-lg border border-blue-500",children:[a.jsx("h4",{className:"font-medium mb-2 text-blue-700",children:"Shipping Label"}),a.jsxs("div",{className:"space-y-3",children:[a.jsx(ke,{value:ne,onChange:le}),a.jsxs("div",{className:"pt-2",children:[a.jsxs(B,{size:"sm",variant:"outline",onClick:async()=>{if(!Y)return;const e=Y.trackingCode||Y.tracking_code,s=Y.shipmentId||"SHIP-"+Math.floor(1e6*Math.random());if(e){de(!0);try{const a=`${c}x${o}x${x} cm`,i=await A({shipmentId:s,carrierName:Y.carrier_name||"E-Parcel Nordic",trackingCode:e,senderAddress:R,recipientAddress:T,packageDetails:{weight:n,dimensions:a},language:ne});i.success?(Y.labelUrl||J({...Y,labelUrl:i.labelUrl}),window.open(i.labelUrl,"_blank"),b({title:"Label Generated",description:"Label has been generated in "+("en"===ne?"English":"fi"===ne?"Finnish":"sv"===ne?"Swedish":"no"===ne?"Norwegian":"Danish")})):b({title:"Label Generation Failed",description:i.message||"Unable to generate shipping label",variant:"destructive"})}catch(a){b({title:"Label Generation Error",description:"An unexpected error occurred",variant:"destructive"})}finally{de(!1)}}else b({title:"Error",description:"Unable to generate label: missing tracking code",variant:"destructive"})},disabled:ce,className:"flex items-center gap-2",children:[a.jsx(U,{className:"h-4 w-4"}),ce?"Generating...":"Generate & Download Label"]}),Y.labelUrl&&a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"A label has already been generated. Generate again to get a new version in your selected language."})]})]})]})]})})]})})]})})]})};export{ye as default};
