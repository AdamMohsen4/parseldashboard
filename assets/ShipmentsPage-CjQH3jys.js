const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/shipmentService-CnTGtXjg.js","assets/index-5r3l8V62.js","assets/ui-D-7D7zMz.js","assets/vendor-BhPmHrfx.js","assets/index-Zhr1NJ4U.css"])))=>i.map(i=>d[i]);
import{q as e,t as s,_ as t,N as a,B as i,C as l,k as n,r,a as d,P as c}from"./index-5r3l8V62.js";import{j as m}from"./ui-D-7D7zMz.js";import{r as x,L as o}from"./vendor-BhPmHrfx.js";import{f as h,D as p,a as u}from"./labelService-BLYnc08N.js";import{T as g,a as j,b as f,c as v}from"./tabs-DEFGl_DY.js";import{A as N}from"./arrow-left-CSJrW0Ft.js";import{L as b,R as y}from"./refresh-cw-DzYBUEVw.js";const w=()=>{const{user:w,isSignedIn:k}=e(),[_,S]=x.useState([]),[C,D]=x.useState(!0),[P,A]=x.useState("all"),[L,T]=x.useState(null);x.useEffect((()=>{k&&w&&E()}),[k,w]);const E=async()=>{if(w){D(!0);try{const e=await h(w.id);if(e&&e.length>0){const s=e.map((e=>({id:e.id.toString(),userId:e.user_id,trackingCode:e.tracking_code||"",carrier:{name:e.carrier_name||"E-Parcel Nordic",price:Number(e.carrier_price)||10},weight:e.weight||"",dimensions:{length:e.dimension_length||"",width:e.dimension_width||"",height:e.dimension_height||""},pickup:e.pickup_address||"",delivery:e.delivery_address||"",deliverySpeed:e.delivery_speed||"standard",includeCompliance:e.include_compliance||!1,status:e.status||"pending",createdAt:e.created_at,labelUrl:e.label_url,pickupTime:e.pickup_time,totalPrice:Number(e.total_price)||10,estimatedDelivery:e.estimated_delivery?new Date(e.estimated_delivery).toISOString().split("T")[0]:void 0,events:[]})));S(s)}else{const e=await I(w.id);S(e)}}catch(e){s({title:"Loading Error",description:"Could not load your shipments. Please try again.",variant:"destructive"})}finally{D(!1)}}},I=async e=>{try{return await t((()=>import("./shipmentService-CnTGtXjg.js")),__vite__mapDeps([0,1,2,3,4])).then((s=>s.getShipments(e)))}catch(s){return[]}},U=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"picked_up":return"bg-blue-100 text-blue-800";case"in_transit":return"bg-indigo-100 text-indigo-800";case"delivered":return"bg-green-100 text-green-800";case"exception":case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},$="all"===P?_:_.filter((e=>{switch(P){case"active":return["pending","picked_up","in_transit"].includes(e.status);case"delivered":return"delivered"===e.status;case"exception":return"exception"===e.status;case"cancelled":return"cancelled"===e.status;default:return!0}}));return m.jsxs("div",{className:"min-h-screen bg-background",children:[m.jsx(a,{}),m.jsx("div",{className:"container mx-auto px-4 py-8",children:m.jsxs("div",{className:"flex flex-col gap-6",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsxs("div",{children:[m.jsx("div",{className:"flex items-center gap-2 mb-2",children:m.jsx(i,{variant:"ghost",size:"sm",asChild:!0,className:"flex items-center gap-1 -ml-2",children:m.jsxs(o,{to:"/dashboard",children:[m.jsx(N,{className:"h-4 w-4"})," Back to Dashboard"]})})}),m.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"My Shipments"}),m.jsx("p",{className:"text-muted-foreground",children:"Track and manage all your shipments"})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsxs(i,{variant:"outline",onClick:()=>{E()},disabled:C,children:[C?m.jsx(b,{className:"h-4 w-4 animate-spin"}):m.jsx(y,{className:"h-4 w-4"}),m.jsx("span",{className:"ml-2",children:"Refresh"})]}),m.jsx(i,{asChild:!0,children:m.jsx(o,{to:"/shipment",children:"New Shipment"})})]})]}),m.jsxs(l,{children:[m.jsx(n,{className:"pb-2",children:m.jsx(r,{children:"Shipment List"})}),m.jsx(d,{children:m.jsxs(g,{defaultValue:"all",value:P,onValueChange:A,className:"w-full",children:[m.jsxs(j,{className:"mb-4",children:[m.jsx(f,{value:"all",children:"All Shipments"}),m.jsx(f,{value:"active",children:"Active"}),m.jsx(f,{value:"delivered",children:"Delivered"}),m.jsx(f,{value:"exception",children:"Exceptions"}),m.jsx(f,{value:"cancelled",children:"Cancelled"})]}),m.jsx(v,{value:P,className:"mt-0",children:C?m.jsx("div",{className:"flex justify-center p-8",children:m.jsx(b,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):0===$.length?m.jsxs("div",{className:"text-center py-8",children:[m.jsx(c,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3"}),m.jsx("h3",{className:"font-medium text-lg mb-2",children:"all"===P?"No shipments found":`No ${P} shipments found`}),m.jsx("p",{className:"text-muted-foreground mb-4",children:"all"===P?"Book your first shipment to get started":"Try selecting a different filter or book a new shipment"}),m.jsx(i,{asChild:!0,children:m.jsx(o,{to:"/shipment",children:"Book a Shipment"})})]}):m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"w-full border-collapse",children:[m.jsx("thead",{children:m.jsxs("tr",{className:"border-b border-border",children:[m.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Tracking"}),m.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Route"}),m.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Status"}),m.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Created"}),m.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Delivery"}),m.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Price"}),m.jsx("th",{className:"text-left py-3 px-4 font-medium",children:"Actions"})]})}),m.jsx("tbody",{className:"divide-y divide-border",children:$.map((e=>m.jsxs("tr",{className:"hover:bg-muted/50",children:[m.jsxs("td",{className:"py-3 px-4",children:[m.jsx("div",{className:"font-medium",children:e.trackingCode}),m.jsx("div",{className:"text-xs text-muted-foreground",children:e.carrier.name})]}),m.jsx("td",{className:"py-3 px-4",children:m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"truncate max-w-[150px]",title:e.pickup,children:e.pickup}),m.jsx("span",{className:"text-xs",children:"↓"}),m.jsx("span",{className:"truncate max-w-[150px]",title:e.delivery,children:e.delivery})]})}),m.jsx("td",{className:"py-3 px-4",children:m.jsxs("span",{className:`text-xs px-2 py-1 rounded-full ${U(e.status)}`,children:["pending"===e.status&&"Pending","picked_up"===e.status&&"Picked Up","in_transit"===e.status&&"In Transit","delivered"===e.status&&"Delivered","exception"===e.status&&"Exception","cancelled"===e.status&&"Cancelled"]})}),m.jsx("td",{className:"py-3 px-4 whitespace-nowrap",children:new Date(e.createdAt).toLocaleDateString()}),m.jsx("td",{className:"py-3 px-4 whitespace-nowrap",children:e.estimatedDelivery?new Date(e.estimatedDelivery).toLocaleDateString():"N/A"}),m.jsxs("td",{className:"py-3 px-4 whitespace-nowrap",children:["€",e.totalPrice.toFixed(2)]}),m.jsx("td",{className:"py-3 px-4",children:m.jsxs("div",{className:"flex gap-2",children:[m.jsx(i,{size:"sm",variant:"outline",asChild:!0,children:m.jsx(o,{to:`/tracking?code=${e.trackingCode}`,children:"Track"})}),m.jsxs(i,{size:"sm",variant:"outline",onClick:()=>(async e=>{const t=e.trackingCode,a="SHIP-"+Math.floor(1e6*Math.random());if(t){T(e.id);try{const i=`${e.dimensions.length}x${e.dimensions.width}x${e.dimensions.height} cm`,l=await u({shipmentId:a,carrierName:e.carrier.name,trackingCode:t,senderAddress:e.pickup,recipientAddress:e.delivery,packageDetails:{weight:e.weight,dimensions:i},language:"en"});l.success?(window.open(l.labelUrl,"_blank"),s({title:"Label Generated",description:"Your shipping label has been generated successfully"})):s({title:"Label Generation Failed",description:l.message||"Unable to generate shipping label",variant:"destructive"})}catch(i){s({title:"Label Generation Error",description:"An unexpected error occurred",variant:"destructive"})}finally{T(null)}}else s({title:"Error",description:"Unable to generate label: missing tracking code",variant:"destructive"})})(e),disabled:L===e.id,children:[L===e.id?m.jsx(b,{className:"h-3 w-3 animate-spin"}):m.jsx(p,{className:"h-3 w-3 mr-1"}),"Label"]})]})})]},e.id)))})]})})})]})})]}),m.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 mt-4",children:[m.jsx("h3",{className:"font-medium mb-2",children:"About Shipment Statuses"}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 text-sm",children:[m.jsxs("div",{children:[m.jsx("div",{className:"flex items-center gap-2 mb-1",children:m.jsx("span",{className:"bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full text-xs",children:"Pending"})}),m.jsx("p",{className:"text-muted-foreground",children:"Shipment has been booked but not yet picked up."})]}),m.jsxs("div",{children:[m.jsx("div",{className:"flex items-center gap-2 mb-1",children:m.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full text-xs",children:"Picked Up"})}),m.jsx("p",{className:"text-muted-foreground",children:"Carrier has collected the package."})]}),m.jsxs("div",{children:[m.jsx("div",{className:"flex items-center gap-2 mb-1",children:m.jsx("span",{className:"bg-indigo-100 text-indigo-800 px-2 py-0.5 rounded-full text-xs",children:"In Transit"})}),m.jsx("p",{className:"text-muted-foreground",children:"Package is on its way to the destination."})]}),m.jsxs("div",{children:[m.jsx("div",{className:"flex items-center gap-2 mb-1",children:m.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-0.5 rounded-full text-xs",children:"Delivered"})}),m.jsx("p",{className:"text-muted-foreground",children:"Package has been delivered successfully."})]}),m.jsxs("div",{children:[m.jsx("div",{className:"flex items-center gap-2 mb-1",children:m.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-0.5 rounded-full text-xs",children:"Cancelled"})}),m.jsx("p",{className:"text-muted-foreground",children:"Shipment has been cancelled."})]})]})]})]})})]})};export{w as default};
