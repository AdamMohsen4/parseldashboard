import{j as e}from"./ui-D-7D7zMz.js";import{r as s}from"./vendor-BhPmHrfx.js";import{c as a,b as i,a0 as t,j as r,a1 as n,q as c,N as l,C as d,k as o,r as h,v as p,a as g,L as m,I as u,B as x,A as j,s as v}from"./index-Brw5S_MN.js";import{r as f,u as y,T as k,a as N,b,c as w,d as C,e as S}from"./xlsx-DqB2vQrE.js";import{C as _}from"./circle-alert-CWTeC4En.js";import{A as E}from"./arrow-left-Dpr6jxrW.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=a("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),F=t("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),$=s.forwardRef((({className:s,variant:a,...t},r)=>e.jsx("div",{ref:r,role:"alert",className:i(F({variant:a}),s),...t})));$.displayName="Alert";const A=s.forwardRef((({className:s,...a},t)=>e.jsx("h5",{ref:t,className:i("mb-1 font-medium leading-none tracking-tight",s),...a})));A.displayName="AlertTitle";const P=s.forwardRef((({className:s,...a},t)=>e.jsx("div",{ref:t,className:i("text-sm [&_p]:leading-relaxed",s),...a})));P.displayName="AlertDescription";const R={name:"",vatNumber:"",address:"",city:"",postalCode:"",country:"",contactPerson:"",email:"",phone:""},H=()=>{r();const{toast:a}=n();c();const[i,t]=s.useState("business-info"),[F,H]=s.useState(R),[I,L]=s.useState(null),[M,B]=s.useState([]),[T,V]=s.useState([]),[U,q]=s.useState(!1),D=e=>{H((s=>({...s,[e.target.name]:e.target.value})))},O=async e=>{var s;const i=null==(s=e.target.files)?void 0:s[0];if(i)try{q(!0),L(i);const e="text/csv"===i.type?await(async e=>new Promise(((s,a)=>{const i=new FileReader;i.onload=e=>{var i;try{const a=(null==(i=e.target)?void 0:i.result).split("\n").map((e=>e.split(","))),t=a[0],r=["recipientName","recipientAddress","recipientCity","recipientPostalCode","recipientCountry","packageWeight","packageLength","packageWidth","packageHeight"].filter((e=>!t.includes(e)));if(r.length>0)throw new Error(`Missing required columns: ${r.join(", ")}`);const n=a.slice(1).filter((e=>e.length===t.length&&e.some((e=>e.trim())))).map((e=>{const s={};return t.forEach(((a,i)=>{s[a.trim()]=e[i].trim()})),s.packageWeight=parseFloat(s.packageWeight),s.packageLength=parseFloat(s.packageLength),s.packageWidth=parseFloat(s.packageWidth),s.packageHeight=parseFloat(s.packageHeight),s}));s(n)}catch(t){a(t)}},i.onerror=()=>a(new Error("Error reading file")),i.readAsText(e)})))(i):await(async e=>new Promise(((s,a)=>{const i=new FileReader;i.onload=e=>{var i;try{const a=new Uint8Array(null==(i=e.target)?void 0:i.result),t=f(a,{type:"array"}),r=t.Sheets[t.SheetNames[0]],n=y.sheet_to_json(r),c=["recipientName","recipientAddress","recipientCity","recipientPostalCode","recipientCountry","packageWeight","packageLength","packageWidth","packageHeight"],l=Object.keys(n[0]||{}),d=c.filter((e=>!l.includes(e)));if(d.length>0)throw new Error(`Missing required columns: ${d.join(", ")}`);const o=n.map((e=>{const s={};return c.forEach((a=>{s[a]=e[a]})),s.packageWeight=parseFloat(s.packageWeight),s.packageLength=parseFloat(s.packageLength),s.packageWidth=parseFloat(s.packageWidth),s.packageHeight=parseFloat(s.packageHeight),s}));s(o)}catch(t){a(t)}},i.onerror=()=>a(new Error("Error reading file")),i.readAsArrayBuffer(e)})))(i),s=(e=>{const s=[];return e.forEach(((e,a)=>{e.recipientName||s.push(`Row ${a+1}: Missing recipient name`),e.recipientAddress||s.push(`Row ${a+1}: Missing recipient address`),e.recipientCity||s.push(`Row ${a+1}: Missing recipient city`),e.recipientPostalCode||s.push(`Row ${a+1}: Missing recipient postal code`),e.recipientCountry||s.push(`Row ${a+1}: Missing recipient country`),(isNaN(e.packageWeight)||e.packageWeight<=0)&&s.push(`Row ${a+1}: Invalid package weight`),(isNaN(e.packageLength)||e.packageLength<=0)&&s.push(`Row ${a+1}: Invalid package length`),(isNaN(e.packageWidth)||e.packageWidth<=0)&&s.push(`Row ${a+1}: Invalid package width`),(isNaN(e.packageHeight)||e.packageHeight<=0)&&s.push(`Row ${a+1}: Invalid package height`)})),{valid:0===s.length,errors:s}})(e);s.valid?(V([]),B(e),a({title:"File Processed",description:`Successfully processed ${e.length} shipments.`})):(V(s.errors),a({title:"Validation Errors",description:"Please fix the errors in your file before proceeding.",variant:"destructive"}))}catch(t){a({title:"Error Processing File",description:t instanceof Error?t.message:"An error occurred while processing the file.",variant:"destructive"})}finally{q(!1)}},Z=()=>{"business-info"===i?t("upload-data"):"upload-data"===i&&M.length>0&&0===T.length&&t("review")},z=()=>{t("review"===i?"upload-data":"business-info")},Y=async e=>{e.preventDefault(),q(!0);try{const{data:e,error:s}=await v.from("high_volume_businesses").insert({name:F.name,vat_number:F.vatNumber,address:F.address,city:F.city,postal_code:F.postalCode,country:F.country,contact_person:F.contactPerson,email:F.email,phone:F.phone}).select().single();if(s)throw new Error(`Failed to save business information: ${s.message}`);const i=M.map((s=>({business_id:e.id,tracking_code:`EP${Date.now().toString().slice(-8)}${Math.random().toString(36).substring(2,6).toUpperCase()}`,recipient_name:s.recipientName,recipient_address:s.recipientAddress,recipient_city:s.recipientCity,recipient_postal_code:s.recipientPostalCode,recipient_country:s.recipientCountry,package_weight:s.packageWeight,package_length:s.packageLength,package_width:s.packageWidth,package_height:s.packageHeight,special_instructions:s.specialInstructions||null,status:"pending"}))),{error:r}=await v.from("high_volume_shipments").insert(i);if(r)throw new Error(`Failed to save shipments: ${r.message}`);a({title:"Success!",description:`Successfully created ${M.length} shipments for ${F.name}`}),H(R),L(null),B([]),t("business-info")}catch(s){a({title:"Error",description:s instanceof Error?s.message:"There was an error processing your request. Please try again.",variant:"destructive"})}finally{q(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(l,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"High Volume Shipment Booking"}),e.jsxs($,{className:"mb-8",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx(A,{children:"Important Information"}),e.jsx(P,{children:"For high volume shipments, please provide your business details and upload a CSV or Excel file containing your shipment data. The file should include columns for recipient name, address, city, postal code, country, and package details."})]}),"business-info"===i&&e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsx(h,{children:"Business Information"}),e.jsx(p,{children:"Please provide your business details for the high volume shipment"})]}),e.jsx(g,{children:e.jsxs("form",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(F).map((([s,a])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:s,children:s.replace(/([A-Z])/g," $1").trim()}),e.jsx(u,{id:s,name:s,value:a,onChange:D,required:!0,type:"email"===s?"email":"phone"===s?"tel":"text"})]},s)))}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(x,{type:"button",onClick:Z,children:["Next ",e.jsx(j,{className:"ml-2 h-4 w-4"})]})})]})})]}),"upload-data"===i&&e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsx(h,{children:"Upload Shipment Data"}),e.jsx(p,{children:"Upload a CSV or Excel file containing your shipment data"})]}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(m,{children:"Shipment Data File"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(u,{type:"file",accept:".csv,.xlsx,.xls",onChange:O,className:"hidden",id:"file-upload",disabled:U}),e.jsxs(m,{htmlFor:"file-upload",className:"flex items-center gap-2 px-4 py-2 border rounded-md cursor-pointer hover:bg-accent",children:[e.jsx(W,{className:"h-4 w-4"}),I?I.name:"Upload CSV or Excel file"]}),I&&e.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>{L(null),B([]),V([])},children:"Clear"})]})]}),T.length>0&&e.jsxs($,{variant:"destructive",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx(A,{children:"Validation Errors"}),e.jsx(P,{children:e.jsx("ul",{className:"list-disc pl-4",children:T.map(((s,a)=>e.jsx("li",{children:s},a)))})})]}),M.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-medium",children:["Preview (",M.length," shipments)"]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(k,{children:[e.jsx(N,{children:e.jsxs(b,{children:[e.jsx(w,{children:"Recipient"}),e.jsx(w,{children:"Address"}),e.jsx(w,{children:"Weight"})]})}),e.jsx(C,{children:M.slice(0,5).map(((s,a)=>e.jsxs(b,{children:[e.jsx(S,{children:s.recipientName}),e.jsx(S,{children:s.recipientAddress}),e.jsxs(S,{children:[s.packageWeight," kg"]})]},a)))})]})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(x,{type:"button",variant:"outline",onClick:z,children:[e.jsx(E,{className:"mr-2 h-4 w-4"})," Back"]}),e.jsxs(x,{type:"button",onClick:Z,disabled:0===M.length||T.length>0,children:["Next ",e.jsx(j,{className:"ml-2 h-4 w-4"})]})]})]})})]}),"review"===i&&e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsx(h,{children:"Review Your Shipment"}),e.jsx(p,{children:"Please review your business information and shipment data before submitting"})]}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Business Information"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(F).map((([s,a])=>e.jsxs("div",{children:[e.jsx(m,{children:s.replace(/([A-Z])/g," $1").trim()}),e.jsx("p",{children:a})]},s)))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Shipment Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsx(m,{children:"Total Packages"}),e.jsx("p",{className:"text-2xl font-bold",children:M.length})]}),e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsx(m,{children:"Total Weight"}),e.jsxs("p",{className:"text-2xl font-bold",children:[M.reduce(((e,s)=>e+s.packageWeight),0).toFixed(2)," kg"]})]}),e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsx(m,{children:"Estimated Cost"}),e.jsxs("p",{className:"text-2xl font-bold",children:["â‚¬",(10*M.length).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(x,{type:"button",variant:"outline",onClick:z,children:[e.jsx(E,{className:"mr-2 h-4 w-4"})," Back"]}),e.jsx(x,{type:"button",onClick:Y,disabled:U,children:U?"Processing...":"Submit Shipment"})]})]})})]})]})})]})};export{H as default};
