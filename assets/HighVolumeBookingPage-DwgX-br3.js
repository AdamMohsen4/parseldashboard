import{j as e}from"./ui-D-7D7zMz.js";import{r as s}from"./vendor-BhPmHrfx.js";import{c as i,b as a,a0 as t,j as r,a1 as n,q as o,N as l,C as c,k as d,r as h,v as g,a as p,L as m,I as u,B as x,A as j,s as v}from"./index-5r3l8V62.js";import{r as k,u as f,T as b,a as y,b as N,c as w,d as V,e as C}from"./xlsx-RHY3E4-Q.js";import{C as _}from"./circle-alert-BQxJCW5W.js";import{A as W}from"./arrow-left-CSJrW0Ft.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=i("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),E=t("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),F=s.forwardRef((({className:s,variant:i,...t},r)=>e.jsx("div",{ref:r,role:"alert",className:a(E({variant:i}),s),...t})));F.displayName="Alert";const A=s.forwardRef((({className:s,...i},t)=>e.jsx("h5",{ref:t,className:a("mb-1 font-medium leading-none tracking-tight",s),...i})));A.displayName="AlertTitle";const R=s.forwardRef((({className:s,...i},t)=>e.jsx("div",{ref:t,className:a("text-sm [&_p]:leading-relaxed",s),...i})));R.displayName="AlertDescription";const P={name:"",vatNumber:"",address:"",city:"",postalCode:"",country:"",contactPerson:"",email:"",phone:""},S=()=>{const{t:i}=r(),{toast:a}=n();o();const[t,E]=s.useState("business-info"),[S,I]=s.useState(P),[D,L]=s.useState(null),[H,M]=s.useState([]),[q,B]=s.useState([]),[T,O]=s.useState(!1),U=e=>{I((s=>({...s,[e.target.name]:e.target.value})))},z=async e=>{var s;const i=null==(s=e.target.files)?void 0:s[0];if(i)try{O(!0),L(i);const e="text/csv"===i.type?await(async e=>new Promise(((s,i)=>{const a=new FileReader;a.onload=e=>{var a;try{const i=(null==(a=e.target)?void 0:a.result).split("\n").map((e=>e.split(","))),t=i[0],r=["recipientName","recipientAddress","recipientCity","recipientPostalCode","recipientCountry","packageWeight","packageLength","packageWidth","packageHeight"].filter((e=>!t.includes(e)));if(r.length>0)throw new Error(`Missing required columns: ${r.join(", ")}`);const n=i.slice(1).filter((e=>e.length===t.length&&e.some((e=>e.trim())))).map((e=>{const s={};return t.forEach(((i,a)=>{s[i.trim()]=e[a].trim()})),s.packageWeight=parseFloat(s.packageWeight),s.packageLength=parseFloat(s.packageLength),s.packageWidth=parseFloat(s.packageWidth),s.packageHeight=parseFloat(s.packageHeight),s}));s(n)}catch(t){i(t)}},a.onerror=()=>i(new Error("Error reading file")),a.readAsText(e)})))(i):await(async e=>new Promise(((s,i)=>{const a=new FileReader;a.onload=e=>{var a;try{const i=new Uint8Array(null==(a=e.target)?void 0:a.result),t=k(i,{type:"array"}),r=t.Sheets[t.SheetNames[0]],n=f.sheet_to_json(r),o=["recipientName","recipientAddress","recipientCity","recipientPostalCode","recipientCountry","packageWeight","packageLength","packageWidth","packageHeight"],l=Object.keys(n[0]||{}),c=o.filter((e=>!l.includes(e)));if(c.length>0)throw new Error(`Missing required columns: ${c.join(", ")}`);const d=n.map((e=>{const s={};return o.forEach((i=>{s[i]=e[i]})),s.packageWeight=parseFloat(s.packageWeight),s.packageLength=parseFloat(s.packageLength),s.packageWidth=parseFloat(s.packageWidth),s.packageHeight=parseFloat(s.packageHeight),s}));s(d)}catch(t){i(t)}},a.onerror=()=>i(new Error("Error reading file")),a.readAsArrayBuffer(e)})))(i),s=(e=>{const s=[];return e.forEach(((e,i)=>{e.recipientName||s.push(`Row ${i+1}: Missing recipient name`),e.recipientAddress||s.push(`Row ${i+1}: Missing recipient address`),e.recipientCity||s.push(`Row ${i+1}: Missing recipient city`),e.recipientPostalCode||s.push(`Row ${i+1}: Missing recipient postal code`),e.recipientCountry||s.push(`Row ${i+1}: Missing recipient country`),(isNaN(e.packageWeight)||e.packageWeight<=0)&&s.push(`Row ${i+1}: Invalid package weight`),(isNaN(e.packageLength)||e.packageLength<=0)&&s.push(`Row ${i+1}: Invalid package length`),(isNaN(e.packageWidth)||e.packageWidth<=0)&&s.push(`Row ${i+1}: Invalid package width`),(isNaN(e.packageHeight)||e.packageHeight<=0)&&s.push(`Row ${i+1}: Invalid package height`)})),{valid:0===s.length,errors:s}})(e);s.valid?(B([]),M(e),a({title:"File Processed",description:`Successfully processed ${e.length} shipments.`})):(B(s.errors),a({title:"Validation Errors",description:"Please fix the errors in your file before proceeding.",variant:"destructive"}))}catch(t){a({title:"Error Processing File",description:t instanceof Error?t.message:"An error occurred while processing the file.",variant:"destructive"})}finally{O(!1)}},G=()=>{"business-info"===t?E("upload-data"):"upload-data"===t&&H.length>0&&0===q.length&&E("review")},J=()=>{E("review"===t?"upload-data":"business-info")},K=async e=>{e.preventDefault(),O(!0);try{const{data:e,error:s}=await v.from("high_volume_businesses").insert({name:S.name,vat_number:S.vatNumber,address:S.address,city:S.city,postal_code:S.postalCode,country:S.country,contact_person:S.contactPerson,email:S.email,phone:S.phone}).select().single();if(s)throw new Error(`Failed to save business information: ${s.message}`);const i=H.map((s=>({business_id:e.id,tracking_code:`EP${Date.now().toString().slice(-8)}${Math.random().toString(36).substring(2,6).toUpperCase()}`,recipient_name:s.recipientName,recipient_address:s.recipientAddress,recipient_city:s.recipientCity,recipient_postal_code:s.recipientPostalCode,recipient_country:s.recipientCountry,package_weight:s.packageWeight,package_length:s.packageLength,package_width:s.packageWidth,package_height:s.packageHeight,special_instructions:s.specialInstructions||null,status:"pending"}))),{error:t}=await v.from("high_volume_shipments").insert(i);if(t)throw new Error(`Failed to save shipments: ${t.message}`);a({title:"Success!",description:`Successfully created ${H.length} shipments for ${S.name}`}),I(P),L(null),M([]),E("business-info")}catch(s){a({title:"Error",description:s instanceof Error?s.message:"There was an error processing your request. Please try again.",variant:"destructive"})}finally{O(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(l,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:i("booking.highVolume.title")}),e.jsxs(F,{className:"mb-8",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx(A,{children:i("booking.highVolume.importantInfo.title")}),e.jsx(R,{children:i("booking.highVolume.importantInfo.description")})]}),"business-info"===t&&e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(h,{children:i("booking.highVolume.businessInfo.title")}),e.jsx(g,{children:i("booking.highVolume.businessInfo.description")})]}),e.jsx(p,{children:e.jsxs("form",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(S).map((([s,a])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:s,children:i(`booking.highVolume.businessInfo.${s}`)}),e.jsx(u,{id:s,name:s,value:a,onChange:U,required:!0,type:"email"===s?"email":"phone"===s?"tel":"text"})]},s)))}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(x,{type:"button",onClick:G,children:[i("booking.highVolume.navigation.next")," ",e.jsx(j,{className:"ml-2 h-4 w-4"})]})})]})})]}),"upload-data"===t&&e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(h,{children:i("booking.highVolume.uploadData.title")}),e.jsx(g,{children:i("booking.highVolume.uploadData.description")})]}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(m,{children:i("booking.highVolume.uploadData.fileLabel")}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(u,{type:"file",accept:".csv,.xlsx,.xls",onChange:z,className:"hidden",id:"file-upload",disabled:T}),e.jsxs(m,{htmlFor:"file-upload",className:"flex items-center gap-2 px-4 py-2 border rounded-md cursor-pointer hover:bg-accent",children:[e.jsx($,{className:"h-4 w-4"}),D?D.name:i("booking.highVolume.uploadData.uploadButton")]}),D&&e.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>{L(null),M([]),B([])},children:i("booking.highVolume.uploadData.clearButton")})]})]}),q.length>0&&e.jsxs(F,{variant:"destructive",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx(A,{children:i("booking.highVolume.uploadData.validationErrors")}),e.jsx(R,{children:e.jsx("ul",{className:"list-disc pl-4",children:q.map(((s,i)=>e.jsx("li",{children:s},i)))})})]}),H.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-medium",children:[i("booking.highVolume.uploadData.preview")," (",H.length," ",i("booking.highVolume.uploadData.shipments"),")"]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(N,{children:[e.jsx(w,{children:"Recipient"}),e.jsx(w,{children:"Address"}),e.jsx(w,{children:"Weight"})]})}),e.jsx(V,{children:H.slice(0,5).map(((s,i)=>e.jsxs(N,{children:[e.jsx(C,{children:s.recipientName}),e.jsx(C,{children:s.recipientAddress}),e.jsxs(C,{children:[s.packageWeight," kg"]})]},i)))})]})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(x,{type:"button",variant:"outline",onClick:J,children:[e.jsx(W,{className:"mr-2 h-4 w-4"})," ",i("booking.highVolume.navigation.back")]}),e.jsxs(x,{type:"button",onClick:G,disabled:0===H.length||q.length>0,children:[i("booking.highVolume.navigation.next")," ",e.jsx(j,{className:"ml-2 h-4 w-4"})]})]})]})})]}),"review"===t&&e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(h,{children:i("booking.highVolume.review.title")}),e.jsx(g,{children:i("booking.highVolume.review.description")})]}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:i("booking.highVolume.review.businessInfo")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(S).map((([s,a])=>e.jsxs("div",{children:[e.jsx(m,{children:i(`booking.highVolume.businessInfo.${s}`)}),e.jsx("p",{children:a})]},s)))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:i("booking.highVolume.review.shipmentSummary")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsx(m,{children:i("booking.highVolume.review.totalPackages")}),e.jsx("p",{className:"text-2xl font-bold",children:H.length})]}),e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsx(m,{children:i("booking.highVolume.review.totalWeight")}),e.jsxs("p",{className:"text-2xl font-bold",children:[H.reduce(((e,s)=>e+s.packageWeight),0).toFixed(2)," kg"]})]}),e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsx(m,{children:i("booking.highVolume.review.estimatedCost")}),e.jsxs("p",{className:"text-2xl font-bold",children:["€",(10*H.length).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(x,{type:"button",variant:"outline",onClick:J,children:[e.jsx(W,{className:"mr-2 h-4 w-4"})," ",i("booking.highVolume.navigation.back")]}),e.jsx(x,{type:"button",onClick:K,disabled:T,children:i(T?"booking.highVolume.review.processing":"booking.highVolume.review.submitButton")})]})]})})]})]})})]})};export{S as default};
